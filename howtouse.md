# GUIファイラーの使い方

## 1. 概要
- PySide6で実装されたクロスプラットフォーム対応のGUIファイルマネージャーです。
- 左ペインのフォルダツリーと右ペインのファイル一覧、動画サムネイルプレビューを備え、大量のファイルも快適に扱えます。
- 設定や検索インデックスはローカルに保存され、OpenCVやゴミ箱連携ライブラリを追加すると機能を拡張できます。

## 2. 推奨環境
- 対応OS: Windows 10/11、macOS 13 Ventura 以降、PySide6 が動作する主要 Linux ディストリビューション。
- Python 3.13 (64bit 推奨) と pip・venv が利用可能な環境。
- GUI 描画に必要な Qt ランタイム (PySide6 に同梱)。
- 動画機能向け追加ライブラリ: opencv-python 4.8 以上、NumPy 1.24 以上 (任意)。
- ゴミ箱連携: winshell (Windows) / send2trash (macOS・Linux) ※任意。
- 機密情報やユーザー固有のパスは OS の環境変数、もしくは .env で管理してください。

## 3. セットアップ手順
### 3.1 リポジトリの取得
1. Git でソースコードを取得します。
   `ash
   git clone <repository-url>
   cd file_manager
   `
2. Python 3.13 が既定のバージョンでない場合は py -3.13 などで呼び出せるよう確認します。

### 3.2 仮想環境の作成と有効化
- Windows (PowerShell)
  `powershell
  python -m venv .venv
  .\.venv\Scripts\Activate.ps1
  `
- macOS / Linux
  `ash
  python3 -m venv .venv
  source .venv/bin/activate
  `

### 3.3 依存パッケージのインストール
`ash
pip install --upgrade pip
pip install -r requirements.txt
`
任意機能のための追加パッケージ:
`ash
# 動画ダイジェストとサムネイルの強化
pip install opencv-python numpy

# OS のゴミ箱へ移動させる機能を有効化
# Windows
pip install winshell
# macOS / Linux
pip install send2trash
`

### 3.4 環境変数と .env
- 機密情報やユーザー固有のパスは .env に保存し、起動前に環境変数として読み込ませてください。
- 空の .env を作成する例:
  `powershell
  New-Item -Type File .env
  `
  `ash
  touch .env
  `
- .env の内容は用途に合わせて定義し、Git にコミットしないよう .gitignore で管理します。
- .env を読み込む場合は OS の set / export や python-dotenv 等を利用して実行環境へ反映させてください。

## 4. アプリの起動と終了
1. 仮想環境を有効化した状態で次を実行します。
   `ash
   python run.py
   `
2. 初回起動時はホームディレクトリが開きます。前回のドライブやパスは自動保存・復元されます。
3. アプリを閉じるか、ターミナルで Ctrl+C を押すと終了します。
4. スタンドアロン実行ファイルが必要な場合は PyInstaller スクリプトを利用します。
   `ash
   python build_exe.py        # ビルド
   python build_exe.py clean  # 生成物の削除
   `
5. 変更後は pytest でテストを行い、正常に動作することを確認してください。

## 5. 画面構成
- **ツールバー**: 上部に配置。上へ戻る (↑)、更新 (↻)、表示モード (リスト/アイコン/詳細)、ソート (名前/サイズ/更新日/種類)、検索ボックス、詳細検索 (🔍)、隠しファイル表示切替 (👁)、設定 (⚙)、ディスク使用量分析 (📊)、重複動画検出、ゴミ箱移動 (🗑️) などのボタンを備えています。
- **ドライブバー**: Windows ではドライブレター、macOS/Linux ではマウントポイントを素早く選択できます。
- **フォルダツリー (左ペイン)**: TreeView でフォルダ構造を表示。選択したフォルダに応じて右ペインが切り替わります。
- **ファイル一覧 (右ペイン)**: 詳細表示に対応した QTreeView。ヘッダーを右クリックすると表示列を切り替えられます。
- **動画サムネイルプレビュー**: 右ペイン下部で動画サムネイルを表示し、必要に応じてダイジェスト表示を起動します。
- **ステータスバー**: 操作状況やエラー通知を表示します。

## 6. 基本操作
### 6.1 フォルダ移動
- 左ペインでフォルダをクリック、または右ペインでフォルダをダブルクリックします。
- ツールバーの ↑ ボタンで一つ上の階層へ戻れます。
- ドライブバーで別ドライブへ直接移動できます。

### 6.2 表示とソート
- 表示モードコンボボックスで「リスト」「アイコン」「詳細」を切り替えます。
- ソートコンボで「名前」「サイズ」「更新日」「種類」順を指定します。
- 詳細表示時は列ヘッダーをドラッグして幅を調整できます。

### 6.3 検索とフィルター
- 検索ボックスに文字列を入力すると、現在のフォルダ内でリアルタイムに絞り込みます。
- 🔍 ボタンから詳細検索ダイアログを開き、インデックス検索を利用できます (詳しくは §7.3)。

### 6.4 ファイル操作
- 右クリックメニューから開く / コピー / 切り取り / 貼り付け / 名前変更 / 削除 / 選択解除を実行できます。
- 「新規フォルダ」は空白部分のコンテキストメニューから作成します。
- ゴミ箱移動 (🗑️) ボタンまたはコンテキストメニューの「選択したファイルをゴミ箱に移動」で OS 標準のゴミ箱へ送れます (winshell/send2trash が必要)。

### 6.5 隠しファイルの表示
- 👁 ボタンで隠しファイルの表示/非表示を切り替えます。
- 設定ダイアログの「色設定」タブで属性ごとの色分けを変更できます。

### 6.6 プレビュー
- 動画ファイルを選択すると右下のプレビュー領域にサムネイルが表示され、OpenCV を導入している場合は高品質なサムネイルになります。

## 7. 追加機能
### 7.1 動画ダイジェスト表示
1. pip install opencv-python numpy を実行し OpenCV を有効化します。
2. 動画ファイルを選択し、右クリックで「動画ダイジェストを表示」を選択するか、設定で自動表示をオンにします。
3. 設定 (⚙) → 「動画ダイジェスト」タブでサムネイル枚数・サイズ・自動表示を調整できます。

### 7.2 重複動画検出
1. ツールバーの「重複動画」ボタンを押すか、フォルダの右クリックメニューから「重複動画を検出」を選択します。
2. フォルダ内の動画をサイズ一致またはファイル名類似度でグループ化し、比較ビューに表示します。
3. チェックしたファイルをゴミ箱へ移動する際は🗑️ボタンまたはダイアログ内の操作を利用します。

### 7.3 インデックス検索
1. 🔍 ボタンで検索ダイアログを開きます。
2. 初回は「インデックス作成」から対象フォルダを指定し、SQLite ベースのインデックス (既定: ~/.file_manager_index.db) を生成します。
3. キーワードや検索条件を入力して結果をダブルクリックすると該当のファイル/フォルダへジャンプします。

### 7.4 ディスク使用量分析
1. 📊 ボタン、またはフォルダの右クリックメニューから「ディスク使用量分析」を選択します。
2. 選択ドライブ/フォルダの容量をグラフで可視化し、リストでドリルダウンできます。
3. 「戻る」操作で一つ上の階層へ戻ります。

### 7.5 動画サムネイルプレビュー
- 動画を選択するとプレビュー領域にサムネイルが表示されます。
- 設定 → 動画ダイジェストタブでサムネイル数とサイズを調整できます。

### 7.6 設定ダイアログ
- ⚙ ボタンから開き、以下を変更できます。
  - 左右ペインのフォントと文字サイズ。
  - 詳細表示で表示する列のオン/オフ。
  - 隠し/読み取り専用/システム/通常ファイルの色分け。
  - 動画ダイジェストのサムネイル数・サイズ・自動表示設定。
- 「保存」で反映され、次回起動時にも同じ設定が復元されます。

## 8. 設定の保存場所と永続データ
- Qt の QSettings を利用して設定を保存します。
  - Windows: HKEY_CURRENT_USER\Software\FileManager\Settings
  - macOS: ~/Library/Preferences/com.FileManager.Settings.plist
  - Linux: ~/.config/FileManager/Settings.conf
- 動画ダイジェストや列表示の設定も同じ領域に保存されます。
- インデックス検索用データベースは既定で ~/.file_manager_index.db に作成されます。必要に応じて検索ダイアログで保存先を変更してください。
- .env などの機密ファイルはリポジトリに含めず、安全に保管してください。

## 9. テストと保守
- 変更を加えた際は以下で動作確認を行います。
  `ash
  pytest
  `
- コード品質の維持には lake8, lack, isort を利用します。
  `ash
  flake8
  black .
  isort .
  `
- 依存パッケージを更新したら equirements.txt を見直し、必要に応じてセキュリティレビューを実施します。

## 10. トラブルシューティング
- ModuleNotFoundError: PySide6 → 仮想環境が有効か確認し、pip install -r requirements.txt を再実行してください。
- ModuleNotFoundError: cv2 → 動画ダイジェスト機能には OpenCV が必要です。pip install opencv-python numpy を導入するか、機能を無効化してください。
- GUI が起動しない / 英語表示になる → Qt のプラットフォームプラグインが見つからない可能性があります。PySide6 の再インストールや QT_QPA_PLATFORM_PLUGIN_PATH などの環境変数を確認してください。
- ゴミ箱へ移動できない → winshell / send2trash が導入済みか、またはファイルへのアクセス権限があるか確認してください。
- インデックス検索が遅い・失敗する → インデックスファイルを削除して再作成するか、対象フォルダを絞って再インデックス化してください。

---

この手順に従うことで、アプリのセットアップから各種機能の活用まで一通り実施できます。最新の機能追加や仕様変更があった場合は README と併せて本ドキュメントも更新してください。
