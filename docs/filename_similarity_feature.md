# ファイル名類似度検出機能

## 概要

ファイル名の類似度に基づいて同一または類似していると思われるファイルをグループ化して表示する機能です。
特に動画ファイルのような連番ファイルや、コピーされたファイルなどを効率的に検出できます。

## 機能の特徴

### 1. ファイル名正規化
- 大文字・小文字の統一
- 特殊文字（ハイフン、アンダースコア、スペース）の統一
- 括弧内の情報（コピー表記など）の除去
- 拡張子の除去

### 2. 類似度計算
- `difflib.SequenceMatcher` を使用した編集距離ベースの類似度計算
- 0.0（完全に異なる）から 1.0（完全に一致）のスコアを算出

### 3. 柔軟な検索設定
- **類似度しきい値**: 0.0-1.0 の範囲で調整可能（デフォルト: 0.7）
- **最小グループサイズ**: グループとして扱う最小ファイル数（デフォルト: 2）
- **再帰検索**: サブフォルダを含めるかどうかを選択可能

### 4. 対象ファイル
デフォルトでは動画ファイルのみが対象:
- .mp4, .avi, .mov, .mkv, .wmv, .flv, .webm, .m4v
- .3gp, .mpg, .mpeg, .mts, .m2ts

## 使い方

### ツールバーから
1. ファイルマネージャーで対象フォルダを選択
2. ツールバーの「類似ファイル名」ボタンをクリック
3. 検索設定を調整（必要に応じて）
4. 「検索開始」ボタンをクリック

### コンテキストメニューから
1. フォルダツリーで対象フォルダを右クリック
2. 「類似ファイル名を検出」を選択
3. ダイアログが表示されるので、検索設定を調整して検索開始

## 検索結果の表示

検索結果はツリー形式で表示されます:

```
グループ 1: video_01.mp4          類似度: 95.00%    3 ファイル
  ├─ video_01.mp4
  ├─ video_02.mp4
  └─ video_03.mp4

グループ 2: movie.mp4             類似度: 88.50%    2 ファイル
  ├─ movie.mp4
  └─ movie (copy).mp4
```

### 操作
- **ファイルをダブルクリック**: 既定のアプリケーションで開く
- **結果をエクスポート**: テキストファイルとして保存

## 実装ファイル

### コアロジック
- `src/file_manager/filename_similarity.py`
  - ファイル名の正規化関数
  - 類似度計算関数
  - 類似ファイル検出関数

### UI
- `src/file_manager/filename_similarity_dialog.py`
  - ダイアログUI
  - バックグラウンドワーカー
  - 結果表示とエクスポート機能

### テスト
- `tests/test_filename_similarity.py`
  - コアロジックのユニットテスト
- `tests/test_filename_similarity_dialog.py`
  - UIのテスト

## 既存機能との違い

### 重複動画検出機能との比較

| 機能 | ファイル名類似度検出 | 重複動画検出 |
|------|-------------------|-------------|
| 検出方法 | ファイル名の類似度 | ファイル内容のハッシュ値 |
| 速度 | 高速 | 低速（ファイルを読み込む必要がある） |
| 精度 | 柔軟（しきい値調整可能） | 厳密（完全一致のみ） |
| 用途 | 連番ファイルやコピーの検出 | 完全に同一のファイルの検出 |

両機能は補完的に使用できます:
1. まず「ファイル名類似度検出」で候補を絞り込む
2. 必要に応じて「重複動画検出」で完全一致を確認

## 設定例

### 連番動画ファイルを検出する場合
- 類似度しきい値: 0.8-0.9
- 最小グループサイズ: 3 以上
- 再帰検索: オフ（単一フォルダ内を検索）

### コピーファイルを検出する場合
- 類似度しきい値: 0.7-0.8
- 最小グループサイズ: 2
- 再帰検索: オン（サブフォルダも含める）

### 厳密に類似したファイルのみを検出する場合
- 類似度しきい値: 0.9-1.0
- 最小グループサイズ: 2
- 再帰検索: オン/オフ（用途に応じて）

## パフォーマンス

- ファイル数が多い場合（1000ファイル以上）、検索に時間がかかることがあります
- 進捗バーで進捗状況を確認できます
- 検索中はダイアログを閉じることで中断できます

## 今後の拡張可能性

- ファジーマッチングアルゴリズムの追加
- カスタム正規化ルールの設定
- 検索結果のフィルタリング機能
- ファイル一括リネーム機能との統合
